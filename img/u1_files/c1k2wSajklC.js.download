;/*FB_PKG_DELIM*/

__d("CometQuickPromotionLoggerContext.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;a=h||d("react");b=a.createContext();g["default"]=b}),98);
__d("CometToastDeferred",["deferredLoadComponent","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";a=c("deferredLoadComponent")(c("requireDeferred")("CometToast.react").__setRef("CometToastDeferred"));b=a;g["default"]=b}),98);
__d("DirectRequestsDeclineMultipleButtonFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("3771");b=d("FalcoLoggerInternal").create("direct_requests_decline_multiple_button",a);e=b;g["default"]=e}),98);
__d("DirectRequestsDeclineMultipleConfirmFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("3772");b=d("FalcoLoggerInternal").create("direct_requests_decline_multiple_confirm",a);e=b;g["default"]=e}),98);
__d("LSRestoreProtobufs.nop",["LSProtobufRestoreHandler","MAWMpsGating","MAWThreadIdToChatJidMapping","MWEBODSEntityName.enum","MWEBODSUtils","WAJids","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e,f,g,h,i,j,k,l,m,n,o,p,q){d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore_protobufs");if(d("MAWMpsGating").isFullMpsEnabled())return;b=null;q!=null?b=d("WAJids").validateChatJid(q):d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore_protobufs.no_chat_jid_provided");b==null&&(b=(yield d("MAWThreadIdToChatJidMapping").genChatJidFromThreadId(a,e,"LSRestoreProtobufs.nop")));b==null&&d("MWEBODSUtils").markODSForEB(c("MWEBODSEntityName.enum").MAW_EB_RESTORE_COUNTER,"restore_protobufs.no_chat_jid");return d("LSProtobufRestoreHandler").handleProtobufRestoreHelper(e,{decryptedMessagesProtobufs:f,type:"decryptedMessagesProtobufs"},g,h,i,j,k,l,m,n,o,p,b)});function e(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){return a.apply(this,arguments)}return e}();a.__nop_name__="LSRestoreProtobufs";g["default"]=a}),98);
__d("LSUserVisibleErrorsUtil",["LSFactory","LSRemoveErrorStoredProcedure","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){c("promiseDone")(a.runInTransaction(function(a){return c("LSRemoveErrorStoredProcedure")(c("LSFactory")(a),{errorId:b})},"readwrite",void 0,void 0,f.id+":24"))}g.removeUserVisibleErrorFromTable=a}),98);
__d("MAWAsyncEBIssueFetchAndIndexFTSQuery",["I64","MAWEBUnstoredDbMsgUtils","MAWJobDefinitions","MAWUserJidWrapper","MpsOverBridge","MpsTypes","WAJids","err"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a,b,e,f,g){f===void 0&&(f=function(){});var i=d("WAJids").threadIdForChatJid(a),j=b==null?Date.now()+6e4:Number(b);f();return d("MpsOverBridge").mps().loadMessages({config:{persistToReverb:"no-persist",shouldFetchSupplementals:!1,shouldFetchTags:!1,shouldIgnoreLocalOnly:!0,strategy:"remote-only"},debug:{purpose:"MAWAsyncEBIssueFetchAndIndexFTSQuery_"+g},direction:"desc",from:[d("MpsTypes").toTimestamp(j),null],numMessages:(h||(h=d("I64"))).to_int32(e),threadId:d("MpsTypes").toThreadId(a)}).then(function(b){var e;if(b.success===!1)throw b.payload||c("err")(b.error);var f=b.value.messages.map(d("MAWJobDefinitions").mpsMessageToEncryptedBackupsMessage);e=b.value.cursorInfo.hasNext?(e=b.value.cursorInfo.endCursor)==null?void 0:e[0]:0;return{echoMessages:[],hasMoreAfter:b.value.cursorInfo.hasPrevious,hasMoreBefore:b.value.cursorInfo.hasNext,isPointQuery:!1,messages:d("MAWEBUnstoredDbMsgUtils").getUnstoredDbMsgFromProtobuf(f,void 0,a,d("MAWUserJidWrapper").getMyUserJid()),nextMessageTimestampMsBefore:e==null?void 0:(h||(h=d("I64"))).of_float(e),protobufMessages:f,referenceTimestamp:j.toString(),requestId:void 0,restoreType:"protobuf",threadId:i}})}g.issueQueryAsPromise=a}),98);
__d("MAWMediaGalleryBufferAndRestore",[],(function(a,b,c,d,e,f){"use strict";var g=null,h=[],i=[],j=[],k=null,l=2e3,m=10;function a(a,b,c,d,e,f,n,o,p,q){q==null||q.addPoint("buffer_and_restore_protobuf_start");var r=function(){h=h.concat(b),i=i.concat(c!=null?c:[]),q!=null&&j.push(q),h.length>=m?(j.forEach(function(a){return a.addPoint("buffer_and_restore_protobuf_end",{string:{reason:"max_buffer_size"}})}),void p(a,h,i,d,e,f,n,o,j),h=[],i=[],j=[]):k=window.setTimeout(function(){var b=[].concat(h),c=[].concat(i),g=[].concat(j);g.forEach(function(a){return a.addPoint("buffer_and_restore_protobuf_end",{string:{reason:"timeout"}})});void p(a,b,c,d,e,f,n,o,g);h=[];i=[];j=[]},l)},s=function(){window.clearTimeout(k);var a=h.map(function(a){return a}),b=i.map(function(a){return a}),c=[].concat(j),l=g;l!=null&&(c.forEach(function(a){return a.addPoint("buffer_and_restore_protobuf_end",{string:{reason:"immediately"}})}),void p(l,a,b,d,e,f,n,o,c));h=[];i=[];j=[]};if(a!==g){s();g=a;r();return}h.length===0?r():(h=h.concat(b),i=i.concat(c!=null?c:[]),q!=null&&j.push(q),h.length>=m&&s())}f.bufferAndRestoreProtobuf=a}),66);
__d("MWMediaRestoreStatus",["I64","LSDatabaseSingleton","MAWChatJid","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j={mediaCount:0,messageCount:0,threadId:(h||(h=d("I64"))).zero};function a(a,b,c){return k.apply(this,arguments)}function k(){k=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,c){var e=(yield (i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton);e=(yield e.runInTransaction(function(b){return d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(b,(h||(h=d("I64"))).of_string(a))},"readwrite",void 0,void 0,f.id+":35"));j.threadId===e?(j.messageCount+=b,j.mediaCount+=c):(j.messageCount=b,j.mediaCount=c,j.threadId=e!=null?e:(h||(h=d("I64"))).zero)});return k.apply(this,arguments)}function c(){return j}g.updateRestoreStatus=a;g.getRestoreStatus=c}),98);
__d("MAWMediaGalleryRestoreSync",["CurrentUser","EchoMessage","EchoMessageMediaFieldUtils","I64","LSDatabaseSingleton","LSIntEnum","LSMEBTaskCreationSource","LSThreadMediaGalleryGroup","MAWChatJid","MAWFTSRestoreSync","MAWHandleEchoProtobufsRestoreApi","MAWJids","MAWJobDefinitions","MAWMediaGalleryBufferAndRestore","MAWMediaGalleryEBTaggingUtils","MAWRestoreMessagesFromEncryptedBackupsDeferred","MAWRestoreProtobufsFromEncryptedBackupsDeferred","MWMediaRestoreStatus","Promise","ReQL","WAJobOrchestratorTypes","WALogger","WAMsgType","asyncToGeneratorRuntime","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m,n,o,p,q;function a(a,b){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){var g=a.echoMessages,p=a.hasMoreAfter,r=a.hasMoreBefore,t=a.isPointQuery,u=a.protobufMessages,v=a.referenceTimestamp,w=a.requestId,x=a.restoreType,y=a.threadId;if(y==null){e==null||e.endFail("threadId is null");d("WALogger").ERROR(h||(h=babelHelpers.taggedTemplateLiteralLoose(["MediaRestore: threadId is null"])));return}e==null||e.addAnnotations({string:{restore_type:x}});e==null||e.addPoint("handle_media_restore_sync_start");var z=!d("MAWMediaGalleryEBTaggingUtils").isMediaGalleryEBTaggingRestoreEnabled();if(x==="echo"){var A;if(g==null){e==null||e.endFail("echoMessages is null");d("WALogger").ERROR(i||(i=babelHelpers.taggedTemplateLiteralLoose(["MediaRestore: echoMessages is null"])));return}e==null||e.addPoint("messages_decoding_and_filtering_start");a=g.filter(function(a){var b;a=d("EchoMessage").decodeEchoMessage(a);return z?(a==null?void 0:a.contentType)===d("EchoMessage").EchoMessageContentType.MEDIA:(a==null||(b=a.mediaData)==null?void 0:b.attachmentType)===d("EchoMessageMediaFieldUtils").AttachmentType.DOCUMENT});e==null||e.addPoint("messages_decoding_and_filtering_end");a.length>0&&d("MAWFTSRestoreSync").MAWGalleryEventEmitter.emit("isPersisting",!0);e==null||e.addAnnotations({"int":{media_count:a.length,message_count:g.length}});e==null||e.addPoint("update_media_restore_status_start");yield d("MWMediaRestoreStatus").updateRestoreStatus(y,g.length,a.length);e==null||e.addPoint("update_media_restore_status_end");e==null||e.addPoint("restore_messages_in_worker_start",{"int":{echo_msg_count:(A=g==null?void 0:g.length)!=null?A:0,protobuf_msg_count:a.length}});c("promiseDone")(d("MAWRestoreMessagesFromEncryptedBackupsDeferred").call("AdvancedCrypto",d("MAWJobDefinitions").toThreadJidPrimaryId(y),a.map(d("MAWJobDefinitions").toEncodedEchoMessage),r,void 0,p,void 0,t,w,v,c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE,d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW)["catch"](function(a){e==null||e.endFail(a),d("WALogger").ERROR(j||(j=babelHelpers.taggedTemplateLiteralLoose(["MediaRestore Echo error: ",""])),a)}),function(){e==null||e.addPoint("restore_messages_in_worker_end"),e==null||e.addPoint("restore_messages_update_ranges_start"),c("promiseDone")((o||(o=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){e==null||e.addPoint("update_range_get_thread_key_start");var g=(yield a.runInTransaction(function(a){return d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(q||(q=d("I64"))).of_string(y))},"readonly",void 0,void 0,f.id+":151"));e==null||e.addPoint("update_range_get_thread_key_end");if(g==null){e==null||e.addPoint("restore_messages_update_ranges_end",{bool:{is_updated:!1}});return}return(n||(n=b("Promise"))).all([s(a,g,c("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS),s(a,g,c("LSThreadMediaGalleryGroup").FILES_ONLY)])});return function(b){return a.apply(this,arguments)}}()).then(function(){d("MAWFTSRestoreSync").MAWGalleryEventEmitter.emit("isPersisting",!1),e==null||e.addPoint("restore_messages_update_ranges_end",{bool:{is_updated:!0}}),e==null||e.addPoint("handle_media_restore_sync_end"),e==null||e.endSuccess()}))})}else if(x==="protobuf"){if(u==null){e==null||e.endFail("protobufMessages is null");d("WALogger").ERROR(k||(k=babelHelpers.taggedTemplateLiteralLoose(["MediaRestore: protobufMessages is null"])));return}e==null||e.addPoint("get_user_jid_start");var B=d("MAWJids").toUserJid(c("CurrentUser").getAccountID());e==null||e.addPoint("get_user_jid_end");e==null||e.addPoint("messages_decoding_and_filtering_start");A=u.filter(function(a){a=d("MAWHandleEchoProtobufsRestoreApi").decodeDecryptedMessageProtobuf(a,B,void 0,new Set(),new Set(),new Map(),new Map(),new Map(),!0);return z&&[d("WAMsgType").MSG_TYPE.IMAGE,d("WAMsgType").MSG_TYPE.VIDEO].includes(a.msgType)||a.msgType===d("WAMsgType").MSG_TYPE.DOCUMENT_FILE});e==null||e.addPoint("messages_decoding_and_filtering_end");A.length>0&&d("MAWFTSRestoreSync").MAWGalleryEventEmitter.emit("isPersisting",!0);e==null||e.addAnnotations({"int":{media_count:A.length,message_count:u.length}});e==null||e.addPoint("update_media_restore_status_start");yield d("MWMediaRestoreStatus").updateRestoreStatus(y,u.length,A.length);e==null||e.addPoint("update_media_restore_status_end");a=function(a,e,g,h,i,j,k,m,p){var r;if(((r=g==null?void 0:g.length)!=null?r:0)===0&&e.length===0){p.forEach(function(a){a.addPoint("restore_messages_in_worker_skipped"),a.endSuccess()});return}p.forEach(function(a){return a.addPoint("restore_messages_in_worker_start",{"int":{echo_msg_count:(a=g==null?void 0:g.length)!=null?a:0,protobuf_msg_count:e.length}})});c("promiseDone")(d("MAWRestoreProtobufsFromEncryptedBackupsDeferred").call("AdvancedCrypto",d("MAWJobDefinitions").toThreadJidPrimaryId(a),e,h,void 0,i,void 0,j,k,m,void 0,g,(q||(q=d("I64"))).of_int32(c("LSMEBTaskCreationSource").MEDIA_GALLERY_RESTORE),d("WAJobOrchestratorTypes").JOB_PRIORITY.LOW,void 0)["catch"](function(a){p.forEach(function(b){return b.endFail(a)}),d("WALogger").ERROR(l||(l=babelHelpers.taggedTemplateLiteralLoose(["MediaRestore Protobuf error: ",""])),a)}),function(){p.forEach(function(a){return a.addPoint("restore_messages_in_worker_end")}),p.forEach(function(a){return a.addPoint("restore_messages_update_ranges_start")}),c("promiseDone")((o||(o=d("LSDatabaseSingleton"))).LSDatabaseSingleton.then(function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){p.forEach(function(a){return a.addPoint("update_range_get_thread_key_start")});var e=(yield a.runInTransaction(function(a){return d("MAWChatJid").toThreadKeyMaybeForChatJidInteger(a,(q||(q=d("I64"))).of_string(y))},"readonly",void 0,void 0,f.id+":314"));p.forEach(function(a){return a.addPoint("update_range_get_thread_key_end")});if(e==null){p.forEach(function(a){return a.addPoint("restore_messages_update_ranges_end",{bool:{is_updated:!1}})});return}return(n||(n=b("Promise"))).all([s(a,e,c("LSThreadMediaGalleryGroup").PHOTOS_AND_VIDEOS),s(a,e,c("LSThreadMediaGalleryGroup").FILES_ONLY)])});return function(b){return a.apply(this,arguments)}}()).then(function(){d("MAWFTSRestoreSync").MAWGalleryEventEmitter.emit("isPersisting",!1),p.forEach(function(a){return a.addPoint("restore_messages_update_ranges_end",{bool:{is_updated:!0}})}),p.forEach(function(a){return a.addPoint("handle_media_restore_sync_end")}),p.forEach(function(a){return a.endSuccess()})}))})};d("MAWMediaGalleryBufferAndRestore").bufferAndRestoreProtobuf(y,A,g,r,p,t,w,v,a,e)}else e==null||e.endFail("RestoreType is none"),d("WALogger").ERROR(m||(m=babelHelpers.taggedTemplateLiteralLoose(["MediaRestore RestoreType is none"])))});return r.apply(this,arguments)}function s(a,c,e){return d("MAWMediaGalleryEBTaggingUtils").isMediaGalleryEBTaggingRestoreEnabled()&&d("MAWMediaGalleryEBTaggingUtils").isMediaGalleryGroupSupportedForTaggedRestore(e)?(n||(n=b("Promise"))).resolve():a.runInTransaction(function(){var f=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var f=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.attachments_ranges_v2__generated).getKeyRange(c).filter(function(a){return(q||(q=d("I64"))).equal(a.mediaGroup,(p||(p=d("LSIntEnum"))).ofNumber(e))})));if(f==null||(f==null?void 0:f.hasMoreBefore)===!0)return;var g=babelHelpers["extends"]({},f,{hasMoreBefore:!0});return b.attachments_ranges_v2__generated.upsert([f.threadKey,f.mediaGroup,f.minTimestampMs],g)});return function(a){return f.apply(this,arguments)}}(),"readwrite","ui",void 0,f.id+":395")}g.handleMediaRestoreSync=a}),98);
__d("MWEncryptedBackUpEBNotEnabledError",[],(function(a,b,c,d,e,f){"use strict";a="EB not enabled";f.EB_NOT_ENABLED=a}),66);
__d("MWMediaRestoreQplUtils",["QPLFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=18e4;function a(){var a=c("qpl")._(25304794,"2287");return d("QPLFlow").startQPLFlow(a,{timeoutInMs:h})}function b(){var a=c("qpl")._(25306381,"2492");return d("QPLFlow").startQPLFlow(a,{timeoutInMs:h})}g.startMediaRestoreBatchQPLFlow=a;g.startMediaRestoreLoadAllQPLFlow=b}),98);
__d("isEbEnabledWithIGDEligibilityCheck",["EBIsEbEnabled","Promise","gkx"],(function(a,b,c,d,e,f,g){"use strict";var h;function a(a){return!c("gkx")("23914")?(h||(h=b("Promise"))).resolve(!1):d("EBIsEbEnabled").isEbEnabledLS(a.tables)}g.isEbEnabledWithIGDEligibilityCheck=a}),98);
__d("MAWFTSRestoreSync",["EventEmitter","FBLogger","I64","LSDatabaseSingleton","MAWAsyncEBIssueFetchAndIndexFTSQuery","MAWBridgeFireAndForget","MAWBridgeSearchMsg","MAWBridgeSendAndReceive","MAWDbMsg","MAWFTSIsMessageValidForSearch","MAWFTSRestoreCap","MAWFTSRestoreSyncLogger","MAWMediaGalleryRestoreSync","MWEncryptedBackUpEBNotEnabledError","MWMediaRestoreQplUtils","Promise","QPLFlow","WAPromiseDelays","asyncToGeneratorRuntime","cr:19810","err","getErrorSafe","isEbEnabledWithIGDEligibilityCheck","justknobx","qpl","uuidv4"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=new(c("EventEmitter"))(),l=(j||(j=d("I64"))).of_int32(c("justknobx")._("2477")),m=c("justknobx")._("2606"),n=c("uuidv4")();function o(a){return new(h||(h=b("Promise")))(function(b,d){return globalThis.setTimeout(function(){return d(c("err")("timeout"))},a)})}function p(){window.setInterval(function(){d("MAWBridgeFireAndForget").fireAndForget("backend","searchFTSReportTabAlive",{hasFocus:document.hasFocus(),tabId:n},!0)},1e3)}function q(a){return r.apply(this,arguments)}function r(){r=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","searchFTSReportTabTaskComplete",{error:a,tabId:n})});return r.apply(this,arguments)}function s(){return t.apply(this,arguments)}function t(){t=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","searchFTSReportTabDestroy",{tabId:n})});return t.apply(this,arguments)}function u(a){var b=200,c=12e4;return Math.min(b*Math.pow(3,a),c)}var v=function(){function a(a){a===void 0&&(a="search"),this.$1=!1,this.$2=!0,this.$3=!1,this.$4=!0,this.$5=void 0,this.$6={},this.$7=new Set(),this.$8=new Set(),this.$9=new Set(),this.$10=a,c("FBLogger")("fts_worker").info("New MAWFTSRestoreSync instance: "+a)}var e=a.prototype;e.setIsStarted=function(a){this.$1=a,this.$10==="media"&&k.emit("isSyncStarted",a)};e.setIsEBMaybeAvailable=function(a){this.$4=a,this.$10==="media"&&k.emit("isEBMaybeAvailable",a)};e.setActiveThreadId=function(a,c){c===void 0&&(c=!0),b("cr:19810")!=null&&c&&(a!=null&&b("cr:19810").getInstance().insertIntoHead(a)),this.$5=a,this.$10==="media"&&k.emit("activeThreadJid",a)};e.setShouldPauseRestore=function(a){this.$3=a};e.removeFromQueue=function(a){b("cr:19810")!=null&&a!=null&&b("cr:19810").getInstance().removeThread(a)};e.getActiveThreadId=function(){return this.$5};e.getNextThreadIdToFetch=function(){if(b("cr:19810")!=null){var a;return(a=b("cr:19810").getInstance().getThreadsHead())!=null?a:this.getActiveThreadId()}return this.getActiveThreadId()};e.getDoneThreads=function(){return this.$7};e.getDoneThreadsAfterReset=function(){return this.$9};e.getResetThreads=function(){return this.$8};e.isStarted=function(){return this.$1};e.isEBMaybeAvailable=function(){return this.$4};e.resetEBAvailability=function(){this.setIsEBMaybeAvailable(!0)};e.resetRestoreStatus=function(){var a=this,c=this.getActiveThreadId();return c!=null&&!this.$8.has(c)?d("MAWBridgeSendAndReceive").sendAndReceive("backend","searchFTSClearThreadRestoreStatus",{threadId:c},{isLoggingDisabled:!0}).then(function(){a.$8.add(c)}):(h||(h=b("Promise"))).resolve()};e.$11=function(a,b){var c=this;Object.keys(this.$6).forEach(function(d){c.$6[d](a,b)})};e.$12=function(a,c,e){return a!==c&&b("cr:19810")!=null?e==null||d("MAWFTSRestoreCap").isRestoreTimeWithinCap(parseInt(e,10)):e!=="0"};e.$13=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){this.setIsStarted(!0),this.setShouldPauseRestore(!1),yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","searchFTSReportTabForeground",{tabId:n},{isLoggingDisabled:!0}),window.addEventListener("focus",b("asyncToGeneratorRuntime").asyncToGenerator(function*(){yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","searchFTSReportTabForeground",{tabId:n},{isLoggingDisabled:!0})})),p()});function c(){return a.apply(this,arguments)}return c}();e.shouldLoop=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){if(this.$1||this.$4===!1)return!1;yield this.$13();a=(yield d("isEbEnabledWithIGDEligibilityCheck").isEbEnabledWithIGDEligibilityCheck(a));if(!a){this.setIsEBMaybeAvailable(!1);this.setIsStarted(!1);return!1}return!0});function c(b){return a.apply(this,arguments)}return c}();e.loadMessages=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,i,k,p){var r=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","searchFTSRequestRestoreTask",{tabId:n,threadJid:a}));if(!r){yield d("WAPromiseDelays").delayMs(200);return"CONTINUE"}var t=d("MAWAsyncEBIssueFetchAndIndexFTSQuery").issueQueryAsPromise(a,e,l,f,k);if(t==null){this.setIsEBMaybeAvailable(!1);this.setIsStarted(!1);return"STOP"}var u=i();u.addAnnotations({"int":{retryCount:g},string:{restoreUntilMs:e!=null?e:""}});try{r=function(){return(h||(h=b("Promise"))).race([t,o(m)])};var v=(yield d("QPLFlow").QplSubspan.wrapInSubspan(u,"fetch_request",r));a=v.nextMessageTimestampMsBefore!=null?(j||(j=d("I64"))).to_int32(v.nextMessageTimestampMsBefore):void 0;f=Number(e)===a;u.addAnnotations({bool:{paginationStuck:f},"int":{numMessages:v.messages.length}});f&&a!=null&&c("justknobx")._("263")&&(v=babelHelpers["extends"]({},v,{nextMessageTimestampMsBefore:(j||(j=d("I64"))).of_int32(a-1)}));yield d("QPLFlow").QplSubspan.wrapInSubspan(u,"process_data",function(){return p(v,u)});u.endSuccess();yield q();return"CONTINUE"}catch(a){k=c("getErrorSafe")(a);if(k&&k.message===d("MWEncryptedBackUpEBNotEnabledError").EB_NOT_ENABLED){u.addPoint("eb_not_enabled");u.endCancel();this.setIsEBMaybeAvailable(!1);this.setIsStarted(!1);yield s();return"STOP"}if(k.message==="invalid-client-state")return"FAIL";c("FBLogger")("fts_worker").catching(k).mustfix("Fail to fetch a new batch of messages");u.endFail((i=k.message)!=null?i:"unknown");yield q(k);return"FAIL"}});function e(b,c,d,e,f,g,h){return a.apply(this,arguments)}return e}();e.startSyncingLoop=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this;this.setShouldPauseRestore(!1);var e=(yield (i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton);if(!(yield this.shouldLoop(e)))return;yield d("MAWFTSRestoreSyncLogger").initLoggingSessionId();var f=0,g=null;e=function*(){var e,h=a.getNextThreadIdToFetch(),i=a.getActiveThreadId();g!==h&&(g=h,f=0);if(h==null||b("cr:19810")==null&&a.$7.has(h)){yield d("WAPromiseDelays").delayMs(200);return 0}if(a.$3){yield d("WAPromiseDelays").delayMs(200);return 0}var k=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","searchFTSGetThreadRestoreStatus",{threadId:h},{isLoggingDisabled:!0})),l=(e=k==null?void 0:k.restoredUntilSortOrderMs)!=null?e:null,m=k==null||k.restoredUntilSortOrderMs===k.maxRestoredUntilSortOrderMs||k.restoredUntilSortOrderMs==null;e=a.$12(h,i,l);if(!e){l==="0"&&(a.$7.add(h),a.$8.has(h)&&a.$9.add(h));a.removeFromQueue(h);yield d("WAPromiseDelays").delayMs(200);return 0}k=(yield a.loadMessages(h,l,function(){d("MAWFTSRestoreSyncLogger").onFetchMessagePageStart(h,l==null||d("MAWFTSRestoreCap").isRestoreTimeWithinCap(parseInt(l,10)),m)},f,function(){return d("QPLFlow").startQPLFlow(c("qpl")._(25300854,"2397"))},"fts",function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var c=b.messages;b=b.nextMessageTimestampMsBefore;b=b!=null?(j||(j=d("I64"))).to_string(b):"0";var e=d("MAWFTSRestoreCap").isRestoreTimeWithinCap(parseInt(b,10));d("MAWFTSRestoreSyncLogger").onFetchMessagePageComplete(h,c.length,e);a.$11(h,c);e=c.map(function(a){var b=d("MAWFTSIsMessageValidForSearch").verifyMessageValidity(a);return b==null?null:d("MAWBridgeSearchMsg").createBridgeSearchMsg(babelHelpers["extends"]({author:a.author,canonicalTs:d("MAWDbMsg").getCanonicalTsFromMsg(a),externalId:a.externalId,threadJid:h},b),!1)}).filter(Boolean);yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","searchIndexUpdate",{newSortOrderMs:b,threadId:h,unvaultedBridgeSearchMessages:e})});return function(a){return c.apply(this,arguments)}}()));$$gen$m0:{if(k==="CONTINUE"){f=0;break $$gen$m0}if(k==="FAIL"){d("MAWFTSRestoreSyncLogger").onFetchMessagePageFailed(h);yield d("WAPromiseDelays").delayMs(u(f));f++;break $$gen$m0}if(k==="STOP"){return{v:void 0};break $$gen$m0}throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+k)}};var h;while(this.$2){h=(yield* e());if(h===0)continue;if(h)return h.v}});function e(){return a.apply(this,arguments)}return e}();e.startMediaSyncingLoop=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=this,c=(yield (i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton);if(!(yield this.shouldLoop(c)))return;var e=0;c=function*(){var c=a.getActiveThreadId();if(c==null||a.$7.has(c)){yield d("WAPromiseDelays").delayMs(200);return 0}if(a.$3){yield d("WAPromiseDelays").delayMs(200);return 0}var f=(yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","getThreadMediaRestoreStatus",{threadId:c},{isLoggingDisabled:!0}));f=(f=f==null?void 0:f.restoredUntilSortOrderMs)!=null?f:null;k.emit("restoredUntilMs",f!=null?parseInt(f,10):-1);var g=a.$12(c,c,f);if(!g){f==="0"&&a.$7.add(c);yield d("WAPromiseDelays").delayMs(200);return 0}g=(yield a.loadMessages(c,f,void 0,e,d("MWMediaRestoreQplUtils").startMediaRestoreBatchQPLFlow,"media",function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var e=a.nextMessageTimestampMsBefore!=null?(j||(j=d("I64"))).to_string(a.nextMessageTimestampMsBefore):"0";yield d("MAWMediaGalleryRestoreSync").handleMediaRestoreSync(a,b);yield d("MAWBridgeSendAndReceive").sendAndReceive("backend","setThreadMediaRestoreStatus",{newSortOrderMs:e,threadId:c},{isLoggingDisabled:!0})});return function(b,c){return a.apply(this,arguments)}}()));$$gen$m1:{if(g==="CONTINUE"){e=0;break $$gen$m1}if(g==="FAIL"){yield d("WAPromiseDelays").delayMs(u(e));e++;break $$gen$m1}if(g==="STOP"){return{v:void 0};break $$gen$m1}throw Error("Match: No case succesfully matched. Make exhaustive or add a wildcard case using '_'. Argument: "+g)}};var f;while(this.$2){f=(yield* c());if(f===0)continue;if(f)return f.v}});function c(){return a.apply(this,arguments)}return c}();a.getInstance=function(){var b=a.instance;if(b!=null)return b;b=new a();a.instance=b;return b};a.getMediaInstance=function(){var b=a.mediaInstance;if(b!=null)return b;b=new a("media");a.mediaInstance=b;return b};a.resetInstance=function(){a.instance=null};e.setKeepWhileLoop_FOR_TESTING_ONLY=function(a){this.$2=a};return a}();v.instance=null;v.mediaInstance=null;function a(){return v.getInstance()}function e(){return v.getMediaInstance()}g.MAWGalleryEventEmitter=k;g.MAWFTSRestoreSync=v;g.getFTSRestoreSync=a;g.getMediaRestoreSync=e}),98);
__d("MDSToastUtils",["fbt","CometScreenReaderText.react","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react");function a(a){return a==="warning"?j.jsx(c("CometScreenReaderText.react"),{text:h._(/*BTDS*/"Advert\u00eancia:")}):j.jsx(c("CometScreenReaderText.react"),{text:h._(/*BTDS*/"Aviso:")})}g.useAnnouncementTitle=a}),226);
__d("MWXToast.react",["MDSToastUtils","cr:1339","cr:3542","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||d("react");function a(a){var c,e=a.actions,f=a.announcementType;f=f===void 0?"general":f;var g=a.assertive;g=g===void 0?!1:g;var h=a.body,j=a.icon,k=a.impressionLoggingRef,l=a.onDismiss,m=a.startAddOn;m=m===void 0?null:m;var n=a.supressCloseButton;n=n===void 0?!1:n;var o=a.testid;o=o===void 0?"mw-toast":o;a=a.title;var p=(j==null?void 0:j.mds)!=null?{hiddenAria:!0,source:j==null?void 0:j.mds,type:"icon"}:void 0;j=(j=j==null?void 0:j.comet)!=null?j:void 0;c=a!=null&&h!=null?i.jsxs(i.Fragment,{children:[a,i.jsx("br",{}),h]}):(c=a!=null?a:h)!=null?c:"";c=i.jsxs(i.Fragment,{children:[d("MDSToastUtils").useAnnouncementTitle(f),c]});j={icon:j,impressionLoggingRef:k,message:c,onDismiss:l,testid:o,withoutCloseButton:n};return b("cr:3542")!=null?i.jsx(b("cr:3542"),{actions:e,announcementType:f,assertive:g,body:h,closeButtonAriaHidden:!0,impressionLoggingRef:k,onDismiss:l,startAddOn:m!==null?m:p,testid:void 0,title:a,withCloseButton:!n}):b("cr:1339")!=null?e!=null?i.jsx(b("cr:1339"),babelHelpers["extends"]({},j,{action:babelHelpers["extends"]({},e.primaryCallToAction)})):i.jsx(b("cr:1339"),babelHelpers["extends"]({},j)):null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("PolarisDirectInboxQPInterstitialQuery.graphql",["relay-runtime"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{kind:"Literal",name:"surface_nux_id",value:11459},{kind:"Literal",name:"trigger_name",value:"INSTAGRAM_DIRECT_WEB_OPEN_PAGE"}],b=[{kind:"Literal",name:"supported",value:"1n7Qkl"}],c={kind:"InlineFragment",selections:[{args:null,documentName:"PolarisDirectInboxQPInterstitialQuery",fragmentName:"CometQuickPromotionInstagramDirectWebEncryptedBackupSoftBlockInterstitialRendererStrategy_quickPromotionRef",fragmentPropName:"quickPromotionRef",kind:"ModuleImport"}],type:"XFBCometQuickPromotionInstagramDirectWebEncryptedBackupSoftBlockInterstitialRendererStrategy",abstractKey:null},d={kind:"InlineFragment",selections:[{args:null,documentName:"PolarisDirectInboxQPInterstitialQuery",fragmentName:"CometQuickPromotionInstagramDirectWebEncryptedBackupHardBlockInterstitialRendererStrategy_quickPromotionRef",fragmentPropName:"quickPromotionRef",kind:"ModuleImport"}],type:"XFBCometQuickPromotionInstagramDirectWebEncryptedBackupHardBlockInterstitialRendererStrategy",abstractKey:null};return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"PolarisDirectInboxQPInterstitialQuery",selections:[{alias:null,args:null,concreteType:"XFBViewer",kind:"LinkedField",name:"xfb_viewer",plural:!1,selections:[{alias:null,args:a,concreteType:"XFBViewerEligibleQuickPromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBQuickPromotion",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBCometQuickPromotionSections",kind:"LinkedField",name:"comet_qp_sections",plural:!1,selections:[{alias:null,args:b,concreteType:null,kind:"LinkedField",name:"renderer_strategy",plural:!1,selections:[c,d],storageKey:'renderer_strategy(supported:"1n7Qkl")'}],storageKey:null}],storageKey:null}],storageKey:'eligible_promotions(surface_nux_id:11459,trigger_name:"INSTAGRAM_DIRECT_WEB_OPEN_PAGE")'}],storageKey:null}],type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"PolarisDirectInboxQPInterstitialQuery",selections:[{alias:null,args:null,concreteType:"XFBViewer",kind:"LinkedField",name:"xfb_viewer",plural:!1,selections:[{alias:null,args:a,concreteType:"XFBViewerEligibleQuickPromotionsConnection",kind:"LinkedField",name:"eligible_promotions",plural:!1,selections:[{alias:null,args:null,concreteType:"XFBQuickPromotion",kind:"LinkedField",name:"nodes",plural:!0,selections:[{alias:null,args:null,concreteType:"XFBCometQuickPromotionSections",kind:"LinkedField",name:"comet_qp_sections",plural:!1,selections:[{alias:null,args:b,concreteType:null,kind:"LinkedField",name:"renderer_strategy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"__typename",storageKey:null},c,d],storageKey:'renderer_strategy(supported:"1n7Qkl")'}],storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null}],storageKey:null}],storageKey:'eligible_promotions(surface_nux_id:11459,trigger_name:"INSTAGRAM_DIRECT_WEB_OPEN_PAGE")'}],storageKey:null}]},params:{id:"9824483370907736",metadata:{},name:"PolarisDirectInboxQPInterstitialQuery",operationKind:"query",text:null}}}();b("relay-runtime").PreloadableQueryRegistry.set(a.params.id,a);e.exports=a}),null);
__d("useQuickPromotionFalcoEvent",["react","requireDeferred"],(function(a,b,c,d,e,f,g){"use strict";var h,i=(h||d("react")).useCallback,j=c("requireDeferred")("QpActionFalcoEvent").__setRef("useQuickPromotionFalcoEvent"),k=c("requireDeferred")("QpImpressionFalcoEvent").__setRef("useQuickPromotionFalcoEvent");function a(a){var b=a.context_surface_id;a=a.context_trigger;var c=a===void 0?"newsfeed":a,d=function(a){return a instanceof Map?Object.fromEntries(a):Object.entries(a!=null?a:{}).reduce(function(a,b){var c=b[0];b=b[1];a[c]=b;return a},{})};a=i(function(a,e,f,g){if(e==null||f==null)return;var h=""+b,i=d(g);j.onReady(function(b){b=b.log;b(function(){return{action_type:a,context_surface_id:h,context_trigger:c,extra_client_data:i,instance_log_data:f,promotion_id:e}})})},[b,c]);var e=i(function(a,e,f){if(a==null||e==null)return;var g=""+b,h=d(f);k.onReady(function(b){b=b.log;b(function(){return{context_surface_id:g,context_trigger:c,extra_client_data:h,instance_log_data:e,promotion_id:a}})})},[b,c]);return{logAction:a,logImpression:e}}g["default"]=a}),98);
__d("PolarisDirectInboxQPInterstitial.react",["CometQuickPromotionLoggerContext.react","CometRelay","PolarisDirectInboxQPInterstitialQuery.graphql","react","react-compiler-runtime","useQuickPromotionFalcoEvent"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||d("react");function a(a){var e,f,g=d("react-compiler-runtime").c(8);a=a.queryRef;a=d("CometRelay").usePreloadedQuery(h!==void 0?h:h=b("PolarisDirectInboxQPInterstitialQuery.graphql"),a);var i;g[0]===Symbol["for"]("react.memo_cache_sentinel")?(i={context_surface_id:11459,context_trigger:"instagram_direct_web_open_page"},g[0]=i):i=g[0];i=c("useQuickPromotionFalcoEvent")(i);var l;if(g[1]!==(a==null||(e=a.xfb_viewer)==null||(e=e.eligible_promotions)==null?void 0:e.nodes)){var m,n;l=a==null||(m=a.xfb_viewer)==null||(m=m.eligible_promotions)==null||(m=m.nodes)==null?void 0:m.find(k);g[1]=a==null||(n=a.xfb_viewer)==null||(n=n.eligible_promotions)==null?void 0:n.nodes;g[2]=l}else l=g[2];a=l;l=a==null||(f=a.comet_qp_sections)==null?void 0:f.renderer_strategy;if(l==null)return null;g[3]!==l?(a=j.jsx(d("CometRelay").MatchContainer,{match:l}),g[3]=l,g[4]=a):a=g[4];g[5]!==i||g[6]!==a?(l=j.jsx(c("CometQuickPromotionLoggerContext.react").Provider,{value:i,children:a}),g[5]=i,g[6]=a,g[7]=l):l=g[7];return l}function k(a){return((a=a.comet_qp_sections)==null?void 0:a.renderer_strategy)!=null}g["default"]=a}),98);
__d("PolarisDirectVerifiedUserCallingNotEnabledModalQuery_instagramRelayOperation",[],(function(a,b,c,d,e,f){e.exports="29587722120841677"}),null);
__d("PolarisDirectVerifiedUserCallingNotEnabledModalQuery.graphql",["PolarisDirectVerifiedUserCallingNotEnabledModalQuery_instagramRelayOperation"],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{alias:null,args:null,concreteType:"FXCALSettings",kind:"LinkedField",name:"fxcal_settings",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"should_user_see_centralized_settings_new_app_ia",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"ig_project_elevation_one_point_five_enabled",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"PolarisDirectVerifiedUserCallingNotEnabledModalQuery",selections:a,type:"Query",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"PolarisDirectVerifiedUserCallingNotEnabledModalQuery",selections:a},params:{id:b("PolarisDirectVerifiedUserCallingNotEnabledModalQuery_instagramRelayOperation"),metadata:{},name:"PolarisDirectVerifiedUserCallingNotEnabledModalQuery",operationKind:"query",text:null}}}();e.exports=a}),null);
__d("PolarisDirectVerifiedUserCallingNotEnabledModal.react",["fbt","CometRelay","CometRelayEnvironmentProvider","IGCoreModal.react","IGDSActionDialog.react","IGDSDialogItem.react","PolarisDirectVerifiedUserCallingNotEnabledModalQuery.graphql","PolarisRoutes","browserHistory_DO_NOT_USE","react","react-compiler-runtime"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j,k=j||d("react"),l=h._(/*BTDS*/"Voc\u00ea pode ativar as liga\u00e7\u00f5es para fazer e receber liga\u00e7\u00f5es da conta que segue. \u00c9 poss\u00edvel desativar esse recurso a qualquer momento nas suas configura\u00e7\u00f5es."),m=h._(/*BTDS*/"Ativar liga\u00e7\u00f5es?"),n=h._(/*BTDS*/"Ativar"),o=h._(/*BTDS*/"Agora n\u00e3o");function p(){var a=d("react-compiler-runtime").c(7),e=q,f=d("CometRelay").useLazyLoadQuery(i!==void 0?i:i=b("PolarisDirectVerifiedUserCallingNotEnabledModalQuery.graphql"),{});f=f.fxcal_settings;var g=(f==null?void 0:f.should_user_see_centralized_settings_new_app_ia)===!0&&(f==null?void 0:f.ig_project_elevation_one_point_five_enabled)===!0;a[0]!==g?(f=function(){e(),d("browserHistory_DO_NOT_USE").browserHistory.push(g?d("PolarisRoutes").HOW_OTHERS_CAN_INTERACT_PATH:d("PolarisRoutes").PRIVACY_AND_SECURITY_PATH)},a[0]=g,a[1]=f):f=a[1];f=f;var h;a[2]!==f?(h=k.jsx(d("IGDSDialogItem.react").IGDSDialogItem,{color:"primaryButton",onClick:f,children:n}),a[2]=f,a[3]=h):h=a[3];a[4]===Symbol["for"]("react.memo_cache_sentinel")?(f=k.jsx(d("IGDSDialogItem.react").IGDSDialogItem,{onClick:e,children:o}),a[4]=f):f=a[4];a[5]!==h?(f=k.jsx(c("IGCoreModal.react"),{children:k.jsxs(c("IGDSActionDialog.react"),{body:l,closeButtonPosition:"background",onModalClose:e,title:m,children:[h,f]})}),a[5]=h,a[6]=f):f=a[6];return f}function q(){}function a(){var a=d("react-compiler-runtime").c(1),b;a[0]===Symbol["for"]("react.memo_cache_sentinel")?(b=k.jsx(c("CometRelayEnvironmentProvider"),{children:k.jsx(p,{})}),a[0]=b):b=a[0];return b}g["default"]=a}),226);
__d("mwPushToast",["ix","BaseToasterStateManager","MWXToast.react","cr:4379","cr:6570","fbicon","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||d("react"),k=c("BaseToasterStateManager").getInstance();function l(a,b){var d=a.announcementType,e=a.assertive,f=a.body,g=a.icon,h=a.impressionLoggingRef,i=a.onDismiss,l=a.startAddOn;l=l===void 0?null:l;var m=a.supressCloseButton;m=m===void 0?!1:m;var n=a.testid;n=a.title;b===void 0&&(b=2750);var o=k.push(j.jsx(c("MWXToast.react"),{announcementType:d,assertive:e,body:f,icon:g,impressionLoggingRef:h,onDismiss:function(){k.expire(o),i==null||i()},startAddOn:l,supressCloseButton:m,testid:void 0,title:n}),b);return o}function a(a,c){var e=a.body,f=a.onDismiss;a=a.title;c===void 0&&(c=2750);var g=b("cr:6570")!==null?j.jsx(b("cr:6570"),{color:"warning",icon:d("fbicon")._(h("502062"),20)}):void 0,i=b("cr:4379")!=null?b("cr:4379"):void 0;return l({announcementType:"warning",assertive:!0,body:e,icon:{comet:g,mds:i},onDismiss:f,title:a},c)}g.mwPushToast=l;g.mwPushErrorToast=a}),98);